<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- This is critical for mobile browsers -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>AEGIS Panic Button</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: #1a1a1a;
        /* Prevents double-tap zoom and scrolling */
        touch-action: manipulation;
      }
      .container {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
      }
      #panicButton {
        width: 100%;
        /* Make the button fill 80% of the screen's height */
        height: 80vh;
        font-size: 5rem;
        font-weight: bold;
        color: white;
        background-color: #d90429; /* Bright Red */
        border: none;
        border-radius: 50px;
        cursor: pointer;

        /* 3D "pressable" effect */
        box-shadow: 0 20px 0 #8d0000; /* Darker red shadow */

        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;

        /* Smooth press animation */
        transition: all 0.07s ease;
      }

      /* "Pressed" state */
      #panicButton:active {
        box-shadow: 0 5px 0 #8d0000;
        transform: translateY(15px);
      }

      /* "Sent" state */
      #panicButton.sent {
        background-color: #2a9d8f; /* Green */
        box-shadow: 0 20px 0 #1a6058; /* Darker green */
        font-size: 4rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <button id="panicButton">PANIC</button>
    </div>

    <script>
      const button = document.getElementById("panicButton");

      button.addEventListener("click", () => {
        // Give haptic feedback on the phone
        if (window.navigator && window.navigator.vibrate) {
          window.navigator.vibrate(200);
        }

        // Change state to "sending"
        button.disabled = true;
        button.innerText = "SENDING...";

        // Send the POST request to the /trigger endpoint on the server
        fetch("/trigger", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Success:", data);
            // Change to "sent" state
            button.innerText = "SENT!";
            button.classList.add("sent");

            // Reset after 3 seconds
            setTimeout(() => {
              button.disabled = false;
              button.innerText = "PANIC";
              button.classList.remove("sent");
            }, 3000);
          })
          .catch((error) => {
            console.error("Error:", error);
            button.disabled = false;
            button.innerText = "ERROR\nRETRY";
            button.classList.remove("sent");
          });
      });
    </script>
  </body>
</html>
